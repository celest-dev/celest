import 'package:celest_cloud_auth/celest_cloud_auth.dart';
import 'package:drift/drift.dart';

import 'log_database.drift.dart';

export 'log_database.drift.dart';

/// Drift table storing audit log entries generated by the fixture backend.
class Logs extends Table {
  /// Primary key for the log entry.
  IntColumn get id => integer().autoIncrement()();

  /// Human readable description of the event.
  TextColumn get message => text().withLength(min: 1, max: 255)();

  /// Creation timestamp recorded for each entry.
  DateTimeColumn get createdAt => dateTime().withDefault(currentDateAndTime)();
}

/// Drift database composed of the [Logs] table and Cloud Auth views.
@DriftDatabase(tables: [Logs], include: CloudAuthDatabaseMixin.includes)
class LogDatabase extends $LogDatabase with CloudAuthDatabaseMixin {
  /// Creates a new [LogDatabase] using the provided executor.
  LogDatabase(super.executor);

  /// Current schema version for the database.
  @override
  int get schemaVersion => 1;

  /// Migration strategy relying on the mixin-provided helper.
  @override
  MigrationStrategy get migration => createMigration();
}
