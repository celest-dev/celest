{"_meta":{"description":"This file contains a serialized version of schema entities for drift.","version":"1.2.0"},"options":{"store_date_time_values_as_text":false},"entities":[{"id":0,"references":[],"type":"table","data":{"name":"cloud_auth_users","was_declared_in_moor":true,"columns":[{"name":"user_id","getter_name":"userId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"given_name","getter_name":"givenName","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"family_name","getter_name":"familyName","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"time_zone","getter_name":"timeZone","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"language_code","getter_name":"languageCode","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"create_time","getter_name":"createTime","moor_type":"double","nullable":false,"customConstraints":"NOT NULL DEFAULT (unixepoch('now', 'subsec'))","default_dart":"const CustomExpression('unixepoch(\\'now\\', \\'subsec\\')')","default_client_dart":null,"dsl_features":[]},{"name":"update_time","getter_name":"updateTime","moor_type":"double","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":false,"constraints":[]}},{"id":1,"references":[],"type":"table","data":{"name":"cedar_types","was_declared_in_moor":true,"columns":[{"name":"fqn","getter_name":"fqn","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]}],"is_virtual":false,"without_rowid":false,"constraints":[]}},{"id":2,"references":[1],"type":"table","data":{"name":"cedar_entities","was_declared_in_moor":true,"columns":[{"name":"entity_type","getter_name":"entityType","moor_type":"string","nullable":false,"customConstraints":"NOT NULL REFERENCES cedar_types(fqn)","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"]},{"name":"entity_id","getter_name":"entityId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"attribute_json","getter_name":"attributeJson","moor_type":"string","nullable":false,"customConstraints":"NOT NULL DEFAULT '{}'","default_dart":"const CustomExpression('\\'{}\\'')","default_client_dart":null,"dsl_features":[],"type_converter":{"dart_expr":"const CedarAttributesConverter()","dart_type_name":"Map<String, Value>"}},{"name":"entity_json","getter_name":"entityJson","moor_type":"string","nullable":false,"customConstraints":"NOT NULL GENERATED ALWAYS AS (json_object('type', entity_type, 'id', entity_id)) VIRTUAL","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"],"type_converter":{"dart_expr":"const CedarEntityUidConverter()","dart_type_name":"EntityUid"}}],"is_virtual":false,"without_rowid":true,"constraints":["CONSTRAINT cedar_entities_pk PRIMARY KEY(entity_type, entity_id)ON CONFLICT IGNORE"],"explicit_pk":["entity_type","entity_id"]}},{"id":3,"references":[0,2],"type":"trigger","data":{"on":0,"references_in_body":[0,2],"name":"cloud_auth_users_create_trg","sql":"CREATE TRIGGER IF NOT EXISTS cloud_auth_users_create_trg\nBEFORE INSERT ON cloud_auth_users\nBEGIN\n    INSERT INTO cedar_entities(entity_type, entity_id)\n    VALUES ('Celest::User', NEW.user_id);\nEND;"}},{"id":4,"references":[2],"type":"table","data":{"name":"cedar_relationships","was_declared_in_moor":true,"columns":[{"name":"entity_type","getter_name":"entityType","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"entity_id","getter_name":"entityId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"entity_json","getter_name":"entityJson","moor_type":"string","nullable":false,"customConstraints":"NOT NULL GENERATED ALWAYS AS (json_object('type', entity_type, 'id', entity_id)) VIRTUAL","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"],"type_converter":{"dart_expr":"const CedarEntityUidConverter()","dart_type_name":"EntityUid"}},{"name":"parent_type","getter_name":"parentType","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"parent_id","getter_name":"parentId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"parent_json","getter_name":"parentJson","moor_type":"string","nullable":false,"customConstraints":"NOT NULL GENERATED ALWAYS AS (json_object('type', parent_type, 'id', parent_id)) VIRTUAL","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"],"type_converter":{"dart_expr":"const CedarEntityUidConverter()","dart_type_name":"EntityUid"}}],"is_virtual":false,"without_rowid":true,"constraints":["CONSTRAINT cedar_relationships_pk PRIMARY KEY(entity_type, entity_id, parent_type, parent_id)ON CONFLICT IGNORE","CONSTRAINT cedar_relationships_fk_entity FOREIGN KEY(entity_type, entity_id)REFERENCES cedar_entities(entity_type, entity_id)ON UPDATE CASCADE ON DELETE CASCADE","CONSTRAINT cedar_relationships_fk_parent FOREIGN KEY(parent_type, parent_id)REFERENCES cedar_entities(entity_type, entity_id)ON UPDATE CASCADE ON DELETE CASCADE"],"explicit_pk":["entity_type","entity_id","parent_type","parent_id"]}},{"id":5,"references":[0,4,2],"type":"trigger","data":{"on":0,"references_in_body":[0,4,2],"name":"cloud_auth_users_delete_trg","sql":"CREATE TRIGGER IF NOT EXISTS cloud_auth_users_delete_trg\nAFTER DELETE ON cloud_auth_users\nBEGIN\n    DELETE FROM cedar_relationships\n    WHERE \n        (entity_type = 'Celest::User' AND entity_id = OLD.user_id)\n    OR  (parent_type = 'Celest::User' AND parent_id = OLD.user_id);\n    DELETE FROM cedar_entities\n    WHERE\n        entity_id = OLD.user_id\n    AND entity_type = 'Celest::User';\nEND;"}},{"id":6,"references":[0],"type":"table","data":{"name":"cloud_auth_user_emails","was_declared_in_moor":true,"columns":[{"name":"user_id","getter_name":"userId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"email","getter_name":"email","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"is_verified","getter_name":"isVerified","moor_type":"bool","nullable":false,"customConstraints":"NOT NULL DEFAULT FALSE","default_dart":"const CustomExpression('FALSE')","default_client_dart":null,"dsl_features":[]},{"name":"is_primary","getter_name":"isPrimary","moor_type":"bool","nullable":false,"customConstraints":"NOT NULL DEFAULT FALSE","default_dart":"const CustomExpression('FALSE')","default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":true,"constraints":["CONSTRAINT cloud_auth_user_emails_pk PRIMARY KEY(user_id, email)","CONSTRAINT cloud_auth_user_emails_user_fk FOREIGN KEY(user_id)REFERENCES cloud_auth_users(user_id)ON UPDATE CASCADE ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED"],"explicit_pk":["user_id","email"]}},{"id":7,"references":[0],"type":"table","data":{"name":"cloud_auth_user_phone_numbers","was_declared_in_moor":true,"columns":[{"name":"user_id","getter_name":"userId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"phone_number","getter_name":"phoneNumber","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"is_verified","getter_name":"isVerified","moor_type":"bool","nullable":false,"customConstraints":"NOT NULL DEFAULT FALSE","default_dart":"const CustomExpression('FALSE')","default_client_dart":null,"dsl_features":[]},{"name":"is_primary","getter_name":"isPrimary","moor_type":"bool","nullable":false,"customConstraints":"NOT NULL DEFAULT FALSE","default_dart":"const CustomExpression('FALSE')","default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":true,"constraints":["CONSTRAINT cloud_auth_user_phone_numbers_pk PRIMARY KEY(user_id, phone_number)","CONSTRAINT cloud_auth_user_phone_numbers_user_fk FOREIGN KEY(user_id)REFERENCES cloud_auth_users(user_id)ON UPDATE CASCADE ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED"],"explicit_pk":["user_id","phone_number"]}},{"id":8,"references":[],"type":"table","data":{"name":"cloud_auth_projects","was_declared_in_moor":true,"columns":[{"name":"project_id","getter_name":"projectId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"version","getter_name":"version","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"resolved_ast","getter_name":"resolvedAst","moor_type":"blob","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[],"type_converter":{"dart_expr":"const ResolvedProjectConverter()","dart_type_name":"ResolvedProject"}},{"name":"etag","getter_name":"etag","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":false,"constraints":[]}},{"id":9,"references":[8],"type":"table","data":{"name":"cloud_auth_apis","was_declared_in_moor":true,"columns":[{"name":"api_id","getter_name":"apiId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"project_id","getter_name":"projectId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"resolved_ast","getter_name":"resolvedAst","moor_type":"blob","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[],"type_converter":{"dart_expr":"const ResolvedApiConverter()","dart_type_name":"ResolvedApi"}},{"name":"etag","getter_name":"etag","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":false,"constraints":["CONSTRAINT cloud_auth_apis_project_fk FOREIGN KEY(project_id)REFERENCES cloud_auth_projects(project_id)ON UPDATE CASCADE ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED"]}},{"id":10,"references":[9],"type":"index","data":{"on":9,"name":"cloud_auth_apis_project_idx","sql":"CREATE INDEX IF NOT EXISTS cloud_auth_apis_project_idx ON cloud_auth_apis(project_id);","unique":false,"columns":[]}},{"id":11,"references":[9,2],"type":"trigger","data":{"on":9,"references_in_body":[9,2],"name":"cloud_auth_apis_create_trg","sql":"CREATE TRIGGER IF NOT EXISTS cloud_auth_apis_create_trg\nBEFORE INSERT ON cloud_auth_apis\nBEGIN\n    INSERT INTO cedar_entities(entity_type, entity_id)\n    VALUES ('Celest::Api', NEW.api_id);\nEND;"}},{"id":12,"references":[9,4,2],"type":"trigger","data":{"on":9,"references_in_body":[9,4,2],"name":"cloud_auth_apis_delete_trg","sql":"CREATE TRIGGER IF NOT EXISTS cloud_auth_apis_delete_trg\nAFTER DELETE ON cloud_auth_apis\nBEGIN\n    DELETE FROM cedar_relationships\n    WHERE \n        entity_type = 'Celest::Api'\n        AND entity_id = OLD.api_id;\n    DELETE FROM cedar_relationships\n    WHERE \n        parent_type = 'Celest::Api'\n        AND parent_id = OLD.api_id;\n    DELETE FROM cedar_entities\n    WHERE\n        entity_type = 'Celest::Api'\n        AND entity_id = OLD.api_id;\nEND;"}},{"id":13,"references":[9],"type":"table","data":{"name":"cloud_auth_functions","was_declared_in_moor":true,"columns":[{"name":"function_id","getter_name":"functionId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"api_id","getter_name":"apiId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"resolved_ast","getter_name":"resolvedAst","moor_type":"blob","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[],"type_converter":{"dart_expr":"const ResolvedFunctionConverter()","dart_type_name":"ResolvedCloudFunction"}},{"name":"etag","getter_name":"etag","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":false,"constraints":["CONSTRAINT cloud_auth_functions_api_fk FOREIGN KEY(api_id)REFERENCES cloud_auth_apis(api_id)ON UPDATE CASCADE ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED"]}},{"id":14,"references":[13],"type":"index","data":{"on":13,"name":"cloud_auth_functions_api_idx","sql":"CREATE INDEX IF NOT EXISTS cloud_auth_functions_api_idx ON cloud_auth_functions(api_id);","unique":false,"columns":[]}},{"id":15,"references":[13,2,4],"type":"trigger","data":{"on":13,"references_in_body":[13,2,4],"name":"cloud_auth_functions_create_trg","sql":"CREATE TRIGGER IF NOT EXISTS cloud_auth_functions_create_trg\nBEFORE INSERT ON cloud_auth_functions\nBEGIN\n    INSERT INTO cedar_entities(entity_type, entity_id)\n    VALUES ('Celest::Function', NEW.function_id);\n    INSERT INTO cedar_relationships(entity_type, entity_id, parent_type, parent_id)\n    VALUES ('Celest::Function', NEW.function_id, 'Celest::Api', NEW.api_id);\nEND;"}},{"id":16,"references":[13,4,2],"type":"trigger","data":{"on":13,"references_in_body":[13,4,2],"name":"cloud_auth_functions_delete_trg","sql":"CREATE TRIGGER IF NOT EXISTS cloud_auth_functions_delete_trg\nAFTER DELETE ON cloud_auth_functions\nBEGIN\n    DELETE FROM cedar_relationships\n    WHERE \n        entity_type = 'Celest::Function'\n        AND entity_id = OLD.function_id;\n    DELETE FROM cedar_relationships\n    WHERE \n        parent_type = 'Celest::Function'\n        AND parent_id = OLD.function_id;\n    DELETE FROM cedar_entities\n    WHERE\n        entity_type = 'Celest::Function'\n        AND entity_id = OLD.function_id;\nEND;"}},{"id":17,"references":[],"type":"table","data":{"name":"cloud_auth_meta","was_declared_in_moor":true,"columns":[{"name":"schema_version","getter_name":"schemaVersion","moor_type":"int","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]}],"is_virtual":false,"without_rowid":false,"constraints":[]}},{"id":999,"references":[17],"type":"special-query","data":{"scenario":"create","sql":"INSERT INTO cloud_auth_meta(schema_version) VALUES (4) ON CONFLICT DO NOTHING"}},{"id":18,"references":[],"type":"table","data":{"name":"cloud_auth_crypto_keys","was_declared_in_moor":true,"columns":[{"name":"crypto_key_id","getter_name":"cryptoKeyId","moor_type":"blob","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"key_purpose","getter_name":"keyPurpose","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"key_algorithm","getter_name":"keyAlgorithm","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"key_material","getter_name":"keyMaterial","moor_type":"blob","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"external_crypto_key_id","getter_name":"externalCryptoKeyId","moor_type":"string","nullable":true,"customConstraints":"UNIQUE","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"]}],"is_virtual":false,"without_rowid":false,"constraints":["CHECK(key_material IS NOT NULL OR external_crypto_key_id IS NOT NULL)"]}},{"id":19,"references":[18],"type":"index","data":{"on":18,"name":"cloud_auth_crypto_keys_external_crypto_key_id_idx","sql":"CREATE INDEX IF NOT EXISTS cloud_auth_crypto_keys_external_crypto_key_id_idx ON cloud_auth_crypto_keys(external_crypto_key_id);","unique":false,"columns":[]}},{"id":20,"references":[0,18],"type":"table","data":{"name":"cloud_auth_sessions","was_declared_in_moor":true,"columns":[{"name":"rowid","getter_name":"rowid","moor_type":"int","nullable":false,"customConstraints":"PRIMARY KEY AUTOINCREMENT","default_dart":null,"default_client_dart":null,"dsl_features":["auto-increment"]},{"name":"session_id","getter_name":"sessionId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL UNIQUE","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"]},{"name":"crypto_key_id","getter_name":"cryptoKeyId","moor_type":"blob","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"user_id","getter_name":"userId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"client_info","getter_name":"clientInfo","moor_type":"blob","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[],"type_converter":{"dart_expr":"const SessionClientConverter()","dart_type_name":"SessionClient"}},{"name":"authentication_factor","getter_name":"authenticationFactor","moor_type":"blob","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[],"type_converter":{"dart_expr":"const AuthenticationFactorConverter()","dart_type_name":"AuthenticationFactor"}},{"name":"state","getter_name":"state","moor_type":"blob","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[],"type_converter":{"dart_expr":"const SessionStateConverter()","dart_type_name":"SessionState"}},{"name":"ip_address","getter_name":"ipAddress","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"external_session_id","getter_name":"externalSessionId","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"create_time","getter_name":"createTime","moor_type":"double","nullable":false,"customConstraints":"NOT NULL DEFAULT (unixepoch('now', 'subsec'))","default_dart":"const CustomExpression('unixepoch(\\'now\\', \\'subsec\\')')","default_client_dart":null,"dsl_features":[]},{"name":"update_time","getter_name":"updateTime","moor_type":"double","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"expire_time","getter_name":"expireTime","moor_type":"double","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":false,"constraints":["CONSTRAINT cloud_auth_sessions_user_fk FOREIGN KEY(user_id)REFERENCES cloud_auth_users(user_id)ON UPDATE CASCADE ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED","CONSTRAINT cloud_auth_sessions_key_fk FOREIGN KEY(crypto_key_id)REFERENCES cloud_auth_crypto_keys(crypto_key_id)ON UPDATE CASCADE ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED"]}},{"id":21,"references":[20],"type":"index","data":{"on":20,"name":"cloud_auth_sessions_user_idx","sql":"CREATE INDEX IF NOT EXISTS cloud_auth_sessions_user_idx ON cloud_auth_sessions(user_id);","unique":false,"columns":[]}},{"id":22,"references":[20],"type":"index","data":{"on":20,"name":"cloud_auth_sessions_crypto_key_idx","sql":"CREATE INDEX IF NOT EXISTS cloud_auth_sessions_crypto_key_idx ON cloud_auth_sessions(crypto_key_id);","unique":false,"columns":[]}},{"id":23,"references":[20],"type":"index","data":{"on":20,"name":"cloud_auth_sessions_external_session_id_idx","sql":"CREATE INDEX IF NOT EXISTS cloud_auth_sessions_external_session_id_idx ON cloud_auth_sessions(external_session_id);","unique":false,"columns":[]}},{"id":24,"references":[20],"type":"trigger","data":{"on":20,"references_in_body":[20],"name":"cloud_auth_sessions_update_time_trg","sql":"CREATE TRIGGER IF NOT EXISTS cloud_auth_sessions_update_time_trg\nAFTER UPDATE ON cloud_auth_sessions\nBEGIN\n    UPDATE cloud_auth_sessions\n    SET update_time = unixepoch('now', 'subsec')\n    WHERE rowid = OLD.rowid;\nEND;"}},{"id":25,"references":[20],"type":"table","data":{"name":"cloud_auth_otp_codes","was_declared_in_moor":true,"columns":[{"name":"rowid","getter_name":"rowid","moor_type":"int","nullable":false,"customConstraints":"PRIMARY KEY AUTOINCREMENT","default_dart":null,"default_client_dart":null,"dsl_features":["auto-increment"]},{"name":"session_id","getter_name":"sessionId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL UNIQUE","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"]},{"name":"resend_attempt","getter_name":"resendAttempt","moor_type":"int","nullable":false,"customConstraints":"NOT NULL DEFAULT 0","default_dart":"const CustomExpression('0')","default_client_dart":null,"dsl_features":[]},{"name":"verify_attempt","getter_name":"verifyAttempt","moor_type":"int","nullable":false,"customConstraints":"NOT NULL DEFAULT 0","default_dart":"const CustomExpression('0')","default_client_dart":null,"dsl_features":[]},{"name":"update_time","getter_name":"updateTime","moor_type":"double","nullable":false,"customConstraints":"NOT NULL DEFAULT (unixepoch('now', 'subsec'))","default_dart":"const CustomExpression('unixepoch(\\'now\\', \\'subsec\\')')","default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":false,"constraints":["CONSTRAINT cloud_auth_otp_codes_session_id_fk FOREIGN KEY(session_id)REFERENCES cloud_auth_sessions(session_id)ON UPDATE CASCADE ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED"]}},{"id":26,"references":[25],"type":"index","data":{"on":25,"name":"cloud_auth_otp_codes_session_id_idx","sql":"CREATE INDEX IF NOT EXISTS cloud_auth_otp_codes_session_id_idx ON cloud_auth_otp_codes(session_id);","unique":false,"columns":[]}},{"id":27,"references":[18,2],"type":"table","data":{"name":"cloud_auth_corks","was_declared_in_moor":true,"columns":[{"name":"cork_id","getter_name":"corkId","moor_type":"blob","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"crypto_key_id","getter_name":"cryptoKeyId","moor_type":"blob","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"bearer_type","getter_name":"bearerType","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"bearer_id","getter_name":"bearerId","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"audience_type","getter_name":"audienceType","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"audience_id","getter_name":"audienceId","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"issuer_type","getter_name":"issuerType","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"issuer_id","getter_name":"issuerId","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"create_time","getter_name":"createTime","moor_type":"double","nullable":false,"customConstraints":"NOT NULL DEFAULT (unixepoch('now', 'subsec'))","default_dart":"const CustomExpression('unixepoch(\\'now\\', \\'subsec\\')')","default_client_dart":null,"dsl_features":[]},{"name":"expire_time","getter_name":"expireTime","moor_type":"double","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"last_use_time","getter_name":"lastUseTime","moor_type":"double","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":false,"constraints":["CONSTRAINT cloud_auth_corks_crypto_key_fk FOREIGN KEY(crypto_key_id)REFERENCES cloud_auth_crypto_keys(crypto_key_id)ON UPDATE CASCADE ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED","CONSTRAINT cloud_auth_corks_bearer_fk FOREIGN KEY(bearer_type, bearer_id)REFERENCES cedar_entities(entity_type, entity_id)ON UPDATE CASCADE ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED","CONSTRAINT cloud_auth_corks_audience_fk FOREIGN KEY(audience_type, audience_id)REFERENCES cedar_entities(entity_type, entity_id)ON UPDATE CASCADE ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED","CONSTRAINT cloud_auth_corks_issuer_fk FOREIGN KEY(issuer_type, issuer_id)REFERENCES cedar_entities(entity_type, entity_id)ON UPDATE CASCADE ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED"]}},{"id":28,"references":[27],"type":"index","data":{"on":27,"name":"cloud_auth_corks_crypto_key_idx","sql":"CREATE INDEX IF NOT EXISTS cloud_auth_corks_crypto_key_idx ON cloud_auth_corks(crypto_key_id);","unique":false,"columns":[]}},{"id":29,"references":[27],"type":"index","data":{"on":27,"name":"cloud_auth_corks_bearer_idx","sql":"CREATE INDEX IF NOT EXISTS cloud_auth_corks_bearer_idx ON cloud_auth_corks(bearer_type, bearer_id);","unique":false,"columns":[]}},{"id":30,"references":[27],"type":"index","data":{"on":27,"name":"cloud_auth_corks_audience_idx","sql":"CREATE INDEX IF NOT EXISTS cloud_auth_corks_audience_idx ON cloud_auth_corks(audience_type, audience_id);","unique":false,"columns":[]}},{"id":31,"references":[27],"type":"index","data":{"on":27,"name":"cloud_auth_corks_issuer_idx","sql":"CREATE INDEX IF NOT EXISTS cloud_auth_corks_issuer_idx ON cloud_auth_corks(issuer_type, issuer_id);","unique":false,"columns":[]}},{"id":32,"references":[4],"type":"index","data":{"on":4,"name":"cedar_relationships_fk_entity_idx","sql":"CREATE INDEX IF NOT EXISTS cedar_relationships_fk_entity_idx ON cedar_relationships(entity_type, entity_id);","unique":false,"columns":[]}},{"id":33,"references":[4],"type":"index","data":{"on":4,"name":"cedar_relationships_fk_parent_idx","sql":"CREATE INDEX IF NOT EXISTS cedar_relationships_fk_parent_idx ON cedar_relationships(parent_type, parent_id);","unique":false,"columns":[]}},{"id":34,"references":[],"type":"table","data":{"name":"cedar_policies","was_declared_in_moor":true,"columns":[{"name":"id","getter_name":"id","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"policy_id","getter_name":"policyId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL UNIQUE","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"]},{"name":"policy","getter_name":"policy","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[],"type_converter":{"dart_expr":"const CedarPolicyConverter()","dart_type_name":"Policy"}},{"name":"enforcement_level","getter_name":"enforcementLevel","moor_type":"int","nullable":false,"customConstraints":"NOT NULL DEFAULT 1","default_dart":"const CustomExpression('1')","default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":false,"constraints":["CHECK(enforcement_level IN (0, 1))"]}},{"id":35,"references":[],"type":"table","data":{"name":"cedar_policy_templates","was_declared_in_moor":true,"columns":[{"name":"id","getter_name":"id","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"template_id","getter_name":"templateId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL UNIQUE","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"]},{"name":"template","getter_name":"template","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[],"type_converter":{"dart_expr":"const CedarPolicyConverter()","dart_type_name":"Policy"}}],"is_virtual":false,"without_rowid":false,"constraints":["CHECK(template IS NOT NULL OR template IS NOT NULL)"]}},{"id":36,"references":[35,2],"type":"table","data":{"name":"cedar_policy_template_links","was_declared_in_moor":true,"columns":[{"name":"id","getter_name":"id","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"policy_id","getter_name":"policyId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL UNIQUE","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"]},{"name":"template_id","getter_name":"templateId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"principal_type","getter_name":"principalType","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"principal_id","getter_name":"principalId","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"resource_type","getter_name":"resourceType","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"resource_id","getter_name":"resourceId","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"enforcement_level","getter_name":"enforcementLevel","moor_type":"int","nullable":false,"customConstraints":"NOT NULL DEFAULT 1","default_dart":"const CustomExpression('1')","default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":false,"constraints":["CHECK(principal_type IS NOT NULL AND principal_id IS NOT NULL OR resource_type IS NOT NULL AND resource_id IS NOT NULL)","CHECK(enforcement_level IN (0, 1))","CONSTRAINT cedar_policy_template_links_fk_template_id FOREIGN KEY(template_id)REFERENCES cedar_policy_templates(template_id)ON UPDATE CASCADE ON DELETE CASCADE","CONSTRAINT cedar_policy_template_links_fk_principal FOREIGN KEY(principal_type, principal_id)REFERENCES cedar_entities(entity_type, entity_id)ON DELETE CASCADE","CONSTRAINT cedar_policy_template_links_fk_resource FOREIGN KEY(resource_type, resource_id)REFERENCES cedar_entities(entity_type, entity_id)ON DELETE CASCADE"]}},{"id":37,"references":[36],"type":"index","data":{"on":36,"name":"cedar_policy_template_links_fk_template_id_idx","sql":"CREATE INDEX IF NOT EXISTS cedar_policy_template_links_fk_template_id_idx ON cedar_policy_template_links(template_id);","unique":false,"columns":[]}},{"id":38,"references":[36],"type":"index","data":{"on":36,"name":"cedar_policy_template_links_fk_principal_idx","sql":"CREATE INDEX IF NOT EXISTS cedar_policy_template_links_fk_principal_idx ON cedar_policy_template_links(principal_type, principal_id);","unique":false,"columns":[]}},{"id":39,"references":[36],"type":"index","data":{"on":36,"name":"cedar_policy_template_links_fk_resource_idx","sql":"CREATE INDEX IF NOT EXISTS cedar_policy_template_links_fk_resource_idx ON cedar_policy_template_links(resource_type, resource_id);","unique":false,"columns":[]}},{"id":40,"references":[],"type":"table","data":{"name":"cedar_authorization_logs","was_declared_in_moor":true,"columns":[{"name":"rowid","getter_name":"rowid","moor_type":"int","nullable":false,"customConstraints":"PRIMARY KEY AUTOINCREMENT","default_dart":null,"default_client_dart":null,"dsl_features":["auto-increment"]},{"name":"create_time","getter_name":"createTime","moor_type":"dateTime","nullable":false,"customConstraints":"NOT NULL DEFAULT (unixepoch('now', 'subsec'))","default_dart":"const CustomExpression('unixepoch(\\'now\\', \\'subsec\\')')","default_client_dart":null,"dsl_features":[]},{"name":"expire_time","getter_name":"expireTime","moor_type":"dateTime","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"principal_type","getter_name":"principalType","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"principal_id","getter_name":"principalId","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"action_type","getter_name":"actionType","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"action_id","getter_name":"actionId","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"resource_type","getter_name":"resourceType","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"resource_id","getter_name":"resourceId","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"context_json","getter_name":"contextJson","moor_type":"string","nullable":false,"customConstraints":"NOT NULL DEFAULT '{}'","default_dart":"const CustomExpression('\\'{}\\'')","default_client_dart":null,"dsl_features":[],"type_converter":{"dart_expr":"const CedarAttributesConverter()","dart_type_name":"Map<String, Value>"}},{"name":"decision","getter_name":"decision","moor_type":"bool","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"reasons_json","getter_name":"reasonsJson","moor_type":"string","nullable":false,"customConstraints":"NOT NULL DEFAULT '[]'","default_dart":"const CustomExpression('\\'[]\\'')","default_client_dart":null,"dsl_features":[],"type_converter":{"dart_expr":"const CedarAuthorizationReasonsConverter()","dart_type_name":"List<String>"}},{"name":"errors_json","getter_name":"errorsJson","moor_type":"string","nullable":false,"customConstraints":"NOT NULL DEFAULT '[]'","default_dart":"const CustomExpression('\\'[]\\'')","default_client_dart":null,"dsl_features":[],"type_converter":{"dart_expr":"const CedarAuthorizationErrorsConverter()","dart_type_name":"AuthorizationErrors"}}],"is_virtual":false,"without_rowid":false,"constraints":[]}},{"id":41,"references":[2],"type":"table","data":{"name":"user_memberships","was_declared_in_moor":true,"columns":[{"name":"membership_id","getter_name":"membershipId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"user_id","getter_name":"userId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"parent_type","getter_name":"parentType","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"parent_id","getter_name":"parentId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"role","getter_name":"role","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"create_time","getter_name":"createTime","moor_type":"dateTime","nullable":false,"customConstraints":"NOT NULL DEFAULT (unixepoch('now', 'subsec'))","default_dart":"const CustomExpression('unixepoch(\\'now\\', \\'subsec\\')')","default_client_dart":null,"dsl_features":[]},{"name":"update_time","getter_name":"updateTime","moor_type":"dateTime","nullable":false,"customConstraints":"NOT NULL DEFAULT (unixepoch('now', 'subsec'))","default_dart":"const CustomExpression('unixepoch(\\'now\\', \\'subsec\\')')","default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":false,"constraints":["CHECK(parent_type = 'Celest::Organization' OR parent_type = 'Celest::Project' OR parent_type = 'Celest::Project::Environment')","CONSTRAINT user_memberships_parent_fk FOREIGN KEY(parent_type, parent_id)REFERENCES cedar_entities(entity_type, entity_id)ON UPDATE CASCADE ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED"]}},{"id":42,"references":[41],"type":"index","data":{"on":41,"name":"user_memberships_parent_idx","sql":"CREATE INDEX IF NOT EXISTS user_memberships_parent_idx ON user_memberships(parent_type, parent_id);","unique":false,"columns":[]}},{"id":43,"references":[41,2,4],"type":"trigger","data":{"on":41,"references_in_body":[41,2,4],"name":"user_memberships_create_trg","sql":"CREATE TRIGGER IF NOT EXISTS user_memberships_create_trg\nBEFORE INSERT ON user_memberships\nBEGIN\n    INSERT INTO cedar_entities(entity_type, entity_id, attribute_json)\n    VALUES (\n        NEW.parent_type || '::Member', \n        NEW.membership_id, \n        json_object(\n            'role', json_object(\n                'type', 'Celest::Role',\n                'id', NEW.role\n            ), \n            'parent', json_object(\n                'type', NEW.parent_type, \n                'id', NEW.parent_id\n            )\n        )\n    );\n    INSERT INTO cedar_relationships(entity_type, entity_id, parent_type, parent_id)\n    VALUES ('Celest::User', NEW.user_id, NEW.parent_type || '::Member', NEW.membership_id);\nEND;"}},{"id":44,"references":[41,2,4],"type":"trigger","data":{"on":41,"references_in_body":[41,2,4],"name":"user_memberships_update_trg","sql":"CREATE TRIGGER IF NOT EXISTS user_memberships_update_trg\nAFTER UPDATE ON user_memberships\nBEGIN\n    UPDATE cedar_entities\n    SET attribute_json = json_object(\n        'role', json_object(\n            'type', 'Celest::Role',\n            'id', NEW.role\n        ), \n        'parent', json_object(\n            'type', OLD.parent_type,\n            'id', OLD.parent_id\n        )\n    )\n    WHERE entity_id = OLD.membership_id AND entity_type = OLD.parent_type || '::Member';\n    UPDATE cedar_relationships\n    SET parent_id = NEW.role\n    WHERE entity_id = OLD.membership_id AND entity_type = OLD.parent_type || '::Member' AND parent_type = 'Celest::Role';\nEND;"}},{"id":45,"references":[41,4,2],"type":"trigger","data":{"on":41,"references_in_body":[41,4,2],"name":"user_memberships_delete_trg","sql":"CREATE TRIGGER IF NOT EXISTS user_memberships_delete_trg\nAFTER DELETE ON user_memberships\nBEGIN\n    DELETE FROM cedar_relationships\n    WHERE \n        entity_id = OLD.membership_id \n        AND entity_type = OLD.parent_type || '::Member';\n    DELETE FROM cedar_relationships\n    WHERE\n        parent_id = OLD.membership_id \n        AND parent_type = OLD.parent_type || '::Member';\n    DELETE FROM cedar_entities\n    WHERE\n        entity_id = OLD.membership_id\n        AND entity_type = OLD.parent_type || '::Member';\nEND;"}},{"id":46,"references":[2],"type":"table","data":{"name":"organizations","was_declared_in_moor":true,"columns":[{"name":"id","getter_name":"id","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"parent_type","getter_name":"parentType","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"parent_id","getter_name":"parentId","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"organization_id","getter_name":"organizationId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL UNIQUE","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"]},{"name":"state","getter_name":"state","moor_type":"string","nullable":false,"customConstraints":"NOT NULL DEFAULT 'CREATING'","default_dart":"const CustomExpression('\\'CREATING\\'')","default_client_dart":null,"dsl_features":[]},{"name":"display_name","getter_name":"displayName","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"create_time","getter_name":"createTime","moor_type":"dateTime","nullable":false,"customConstraints":"NOT NULL DEFAULT (unixepoch('now', 'subsec'))","default_dart":"const CustomExpression('unixepoch(\\'now\\', \\'subsec\\')')","default_client_dart":null,"dsl_features":[]},{"name":"update_time","getter_name":"updateTime","moor_type":"dateTime","nullable":false,"customConstraints":"NOT NULL DEFAULT (unixepoch('now', 'subsec'))","default_dart":"const CustomExpression('unixepoch(\\'now\\', \\'subsec\\')')","default_client_dart":null,"dsl_features":[]},{"name":"delete_time","getter_name":"deleteTime","moor_type":"dateTime","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"purge_time","getter_name":"purgeTime","moor_type":"dateTime","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"annotations","getter_name":"annotations","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"primary_region","getter_name":"primaryRegion","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"reconciling","getter_name":"reconciling","moor_type":"bool","nullable":false,"customConstraints":"NOT NULL DEFAULT FALSE","default_dart":"const CustomExpression('FALSE')","default_client_dart":null,"dsl_features":[]},{"name":"etag","getter_name":"etag","moor_type":"string","nullable":false,"customConstraints":"NOT NULL GENERATED ALWAYS AS (hex(md5(json_array(id, parent_type, parent_id, organization_id, state, display_name, create_time, update_time, delete_time, purge_time, annotations, primary_region, reconciling)))) STORED","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"]}],"is_virtual":false,"without_rowid":false,"constraints":["CONSTRAINT organizations_parent_fk FOREIGN KEY(parent_type, parent_id)REFERENCES cedar_entities(entity_type, entity_id)ON UPDATE CASCADE ON DELETE SET NULL"]}},{"id":47,"references":[46,41],"type":"trigger","data":{"on":46,"references_in_body":[46,41],"name":"organizations_delete_user_memberships_trg","sql":"CREATE TRIGGER IF NOT EXISTS organizations_delete_user_memberships_trg\nAFTER DELETE ON organizations\nBEGIN\n    DELETE FROM user_memberships\n    WHERE\n        parent_type = 'Celest::Organization'\n        AND parent_id = OLD.id;\nEND;"}},{"id":48,"references":[2,46],"type":"table","data":{"name":"projects","was_declared_in_moor":true,"columns":[{"name":"id","getter_name":"id","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"parent_type","getter_name":"parentType","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"parent_id","getter_name":"parentId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"project_id","getter_name":"projectId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"state","getter_name":"state","moor_type":"string","nullable":false,"customConstraints":"NOT NULL DEFAULT 'CREATING'","default_dart":"const CustomExpression('\\'CREATING\\'')","default_client_dart":null,"dsl_features":[]},{"name":"display_name","getter_name":"displayName","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"create_time","getter_name":"createTime","moor_type":"dateTime","nullable":false,"customConstraints":"NOT NULL DEFAULT (unixepoch('now', 'subsec'))","default_dart":"const CustomExpression('unixepoch(\\'now\\', \\'subsec\\')')","default_client_dart":null,"dsl_features":[]},{"name":"update_time","getter_name":"updateTime","moor_type":"dateTime","nullable":false,"customConstraints":"NOT NULL DEFAULT (unixepoch('now', 'subsec'))","default_dart":"const CustomExpression('unixepoch(\\'now\\', \\'subsec\\')')","default_client_dart":null,"dsl_features":[]},{"name":"delete_time","getter_name":"deleteTime","moor_type":"dateTime","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"purge_time","getter_name":"purgeTime","moor_type":"dateTime","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"annotations","getter_name":"annotations","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"regions","getter_name":"regions","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"reconciling","getter_name":"reconciling","moor_type":"bool","nullable":false,"customConstraints":"NOT NULL DEFAULT FALSE","default_dart":"const CustomExpression('FALSE')","default_client_dart":null,"dsl_features":[]},{"name":"etag","getter_name":"etag","moor_type":"string","nullable":false,"customConstraints":"NOT NULL GENERATED ALWAYS AS (hex(md5(json_array(id, parent_type, parent_id, project_id, state, display_name, create_time, update_time, delete_time, purge_time, annotations, regions, reconciling)))) STORED","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"]}],"is_virtual":false,"without_rowid":false,"constraints":["CHECK(parent_type = 'Celest::Organization')","CONSTRAINT projects_fk_parent FOREIGN KEY(parent_type, parent_id)REFERENCES cedar_entities(entity_type, entity_id)ON UPDATE CASCADE ON DELETE CASCADE","CONSTRAINT projects_fk_organization FOREIGN KEY(parent_id)REFERENCES organizations(id)ON UPDATE CASCADE ON DELETE CASCADE","CONSTRAINT projects_uq_project_id UNIQUE(project_id, parent_id)"],"unique_keys":[["project_id","parent_id"]]}},{"id":49,"references":[48,41],"type":"trigger","data":{"on":48,"references_in_body":[48,41],"name":"projects_delete_user_memberships_trg","sql":"CREATE TRIGGER IF NOT EXISTS projects_delete_user_memberships_trg\nAFTER DELETE ON projects\nBEGIN\n    DELETE FROM user_memberships\n    WHERE\n        parent_type = 'Celest::Project'\n        AND parent_id = OLD.id;\nEND;"}},{"id":50,"references":[2,48],"type":"table","data":{"name":"project_environments","was_declared_in_moor":true,"columns":[{"name":"id","getter_name":"id","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"parent_type","getter_name":"parentType","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"parent_id","getter_name":"parentId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"project_environment_id","getter_name":"projectEnvironmentId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"state","getter_name":"state","moor_type":"string","nullable":false,"customConstraints":"NOT NULL DEFAULT 'CREATING'","default_dart":"const CustomExpression('\\'CREATING\\'')","default_client_dart":null,"dsl_features":[]},{"name":"display_name","getter_name":"displayName","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"create_time","getter_name":"createTime","moor_type":"dateTime","nullable":false,"customConstraints":"NOT NULL DEFAULT (unixepoch('now', 'subsec'))","default_dart":"const CustomExpression('unixepoch(\\'now\\', \\'subsec\\')')","default_client_dart":null,"dsl_features":[]},{"name":"update_time","getter_name":"updateTime","moor_type":"dateTime","nullable":false,"customConstraints":"NOT NULL DEFAULT (unixepoch('now', 'subsec'))","default_dart":"const CustomExpression('unixepoch(\\'now\\', \\'subsec\\')')","default_client_dart":null,"dsl_features":[]},{"name":"delete_time","getter_name":"deleteTime","moor_type":"dateTime","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"annotations","getter_name":"annotations","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"reconciling","getter_name":"reconciling","moor_type":"bool","nullable":false,"customConstraints":"NOT NULL GENERATED ALWAYS AS (state IN ('CREATING', 'UPDATING', 'DELETING')) VIRTUAL","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"]},{"name":"etag","getter_name":"etag","moor_type":"string","nullable":false,"customConstraints":"NOT NULL GENERATED ALWAYS AS (hex(md5(json_array(id, parent_type, parent_id, project_environment_id, state, display_name, create_time, update_time, delete_time, annotations, reconciling)))) STORED","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"]}],"is_virtual":false,"without_rowid":false,"constraints":["CHECK(parent_type = 'Celest::Project')","CONSTRAINT project_environments_parent_fk FOREIGN KEY(parent_type, parent_id)REFERENCES cedar_entities(entity_type, entity_id)ON UPDATE CASCADE ON DELETE CASCADE","CONSTRAINT project_environments_organization_fk FOREIGN KEY(parent_id)REFERENCES projects(id)ON UPDATE CASCADE ON DELETE CASCADE","CONSTRAINT project_environments_project_environment_id_unique_idx UNIQUE(project_environment_id, parent_id)"],"unique_keys":[["project_environment_id","parent_id"]]}},{"id":51,"references":[50,41],"type":"trigger","data":{"on":50,"references_in_body":[50,41],"name":"project_environments_delete_user_memberships_trg","sql":"CREATE TRIGGER IF NOT EXISTS project_environments_delete_user_memberships_trg\nAFTER DELETE ON project_environments\nBEGIN\n    DELETE FROM user_memberships\n    WHERE\n        parent_type = 'Celest::Project::Environment'\n        AND parent_id = OLD.id;\nEND;"}},{"id":52,"references":[50],"type":"index","data":{"on":50,"name":"project_environments_parent_idx","sql":"CREATE INDEX IF NOT EXISTS project_environments_parent_idx ON project_environments(parent_type, parent_id);","unique":false,"columns":[]}},{"id":53,"references":[50],"type":"trigger","data":{"on":50,"references_in_body":[50],"name":"project_environments_update_time_trg","sql":"CREATE TRIGGER IF NOT EXISTS project_environments_update_time_trg\nAFTER UPDATE ON project_environments\nBEGIN\n    UPDATE project_environments\n    SET update_time = unixepoch('now', 'subsec')\n    WHERE id = OLD.id;\nEND;"}},{"id":54,"references":[50,2,4],"type":"trigger","data":{"on":50,"references_in_body":[50,2,4],"name":"project_environments_create_trg","sql":"CREATE TRIGGER IF NOT EXISTS project_environments_create_trg\nBEFORE INSERT ON project_environments\nBEGIN\n    INSERT INTO cedar_entities(entity_type, entity_id)\n    VALUES ('Celest::Project::Environment', NEW.id);\n    INSERT INTO cedar_relationships(entity_type, entity_id, parent_type, parent_id)\n    VALUES ('Celest::Project::Environment', NEW.id, NEW.parent_type, NEW.parent_id);\nEND;"}},{"id":55,"references":[50,4],"type":"trigger","data":{"on":50,"references_in_body":[50,4],"name":"project_environments_set_parent_trg","sql":"CREATE TRIGGER IF NOT EXISTS project_environments_set_parent_trg\nAFTER UPDATE OF parent_type, parent_id ON project_environments\nWHEN OLD.parent_type != NEW.parent_type OR OLD.parent_id != NEW.parent_id\nBEGIN\n    UPDATE cedar_relationships\n    SET \n        parent_type = NEW.parent_type,\n        parent_id = NEW.parent_id\n    WHERE \n        entity_id = OLD.id \n        AND entity_type = 'Celest::Project::Environment';\nEND;"}},{"id":56,"references":[50,4,2],"type":"trigger","data":{"on":50,"references_in_body":[50,4,2],"name":"project_environments_delete_trg","sql":"CREATE TRIGGER IF NOT EXISTS project_environments_delete_trg\nAFTER DELETE ON project_environments\nBEGIN\n    DELETE FROM cedar_relationships\n    WHERE \n        entity_id = OLD.id \n        AND entity_type = 'Celest::Project::Environment';\n    DELETE FROM cedar_entities\n    WHERE\n        entity_id = OLD.id\n        AND entity_type = 'Celest::Project::Environment';\nEND;"}},{"id":57,"references":[50],"type":"table","data":{"name":"project_environment_asts","was_declared_in_moor":true,"columns":[{"name":"project_environment_id","getter_name":"projectEnvironmentId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"ast","getter_name":"ast","moor_type":"blob","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"version","getter_name":"version","moor_type":"int","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"digest","getter_name":"digest","moor_type":"string","nullable":false,"customConstraints":"NOT NULL GENERATED ALWAYS AS (hex(md5(ast))) STORED","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"]}],"is_virtual":false,"without_rowid":true,"constraints":["CONSTRAINT fk_environment_metadata_project_environment_id FOREIGN KEY(project_environment_id)REFERENCES project_environments(id)ON UPDATE CASCADE ON DELETE CASCADE"]}},{"id":58,"references":[50],"type":"table","data":{"name":"project_environment_assets","was_declared_in_moor":true,"columns":[{"name":"project_environment_id","getter_name":"projectEnvironmentId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"type","getter_name":"type","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"bucket","getter_name":"bucket","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"name","getter_name":"name","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"etag","getter_name":"etag","moor_type":"string","nullable":false,"customConstraints":"NOT NULL","default_dart":null,"default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":true,"constraints":["PRIMARY KEY(project_environment_id, name)","CONSTRAINT fk_environment_assets_project_environment_id FOREIGN KEY(project_environment_id)REFERENCES project_environments(id)ON UPDATE CASCADE ON DELETE CASCADE"],"explicit_pk":["project_environment_id","name"]}},{"id":59,"references":[50],"type":"table","data":{"name":"project_environment_states","was_declared_in_moor":true,"columns":[{"name":"project_environment_id","getter_name":"projectEnvironmentId","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"fly_app_name","getter_name":"flyAppName","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"fly_volume_name","getter_name":"flyVolumeName","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"domain_name","getter_name":"domainName","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":true,"constraints":["CONSTRAINT fk_project_environment_state_project_environment_id FOREIGN KEY(project_environment_id)REFERENCES project_environments(id)ON UPDATE CASCADE ON DELETE CASCADE"]}},{"id":60,"references":[48],"type":"index","data":{"on":48,"name":"projects_fk_parent_idx","sql":"CREATE INDEX IF NOT EXISTS projects_fk_parent_idx ON projects(parent_type, parent_id);","unique":false,"columns":[]}},{"id":61,"references":[48],"type":"trigger","data":{"on":48,"references_in_body":[48],"name":"projects_update_time_trg","sql":"CREATE TRIGGER IF NOT EXISTS projects_update_time_trg\nAFTER UPDATE ON projects\nBEGIN\n    UPDATE projects\n    SET update_time = unixepoch('now', 'subsec')\n    WHERE id = OLD.id;\nEND;"}},{"id":62,"references":[48,2,4],"type":"trigger","data":{"on":48,"references_in_body":[48,2,4],"name":"projects_create_trg","sql":"CREATE TRIGGER IF NOT EXISTS projects_create_trg\nBEFORE INSERT ON projects\nBEGIN\n    INSERT INTO cedar_entities(entity_type, entity_id)\n    VALUES ('Celest::Project', NEW.id);\n    INSERT INTO cedar_relationships(entity_type, entity_id, parent_type, parent_id)\n    VALUES ('Celest::Project', NEW.id, NEW.parent_type, NEW.parent_id);\nEND;"}},{"id":63,"references":[48,4],"type":"trigger","data":{"on":48,"references_in_body":[48,4],"name":"projects_set_parent_trg","sql":"CREATE TRIGGER IF NOT EXISTS projects_set_parent_trg\nAFTER UPDATE OF parent_type, parent_id ON projects\nWHEN OLD.parent_type != NEW.parent_type OR OLD.parent_id != NEW.parent_id\nBEGIN\n    UPDATE cedar_relationships\n    SET \n        parent_type = NEW.parent_type,\n        parent_id = NEW.parent_id\n    WHERE \n        entity_id = OLD.id \n        AND entity_type = 'Celest::Project';\nEND;"}},{"id":64,"references":[48,4,2],"type":"trigger","data":{"on":48,"references_in_body":[48,4,2],"name":"projects_delete_trg","sql":"CREATE TRIGGER IF NOT EXISTS projects_delete_trg\nAFTER DELETE ON projects\nBEGIN\n    DELETE FROM cedar_relationships\n    WHERE \n        entity_type = 'Celest::Project'\n        AND entity_id = OLD.id;\n    DELETE FROM cedar_relationships\n    WHERE \n        parent_type = 'Celest::Project'\n        AND parent_id = OLD.id;\n    DELETE FROM cedar_entities\n    WHERE\n        entity_id = OLD.id\n        AND entity_type = 'Celest::Project';\nEND;"}},{"id":65,"references":[46],"type":"index","data":{"on":46,"name":"organizations_parent_idx","sql":"CREATE INDEX IF NOT EXISTS organizations_parent_idx ON organizations(parent_type, parent_id);","unique":false,"columns":[]}},{"id":66,"references":[46],"type":"trigger","data":{"on":46,"references_in_body":[46],"name":"organizations_update_time","sql":"CREATE TRIGGER IF NOT EXISTS organizations_update_time\nAFTER UPDATE ON organizations\nBEGIN\n    UPDATE organizations\n    SET update_time = unixepoch('now', 'subsec')\n    WHERE id = OLD.id;\nEND;"}},{"id":67,"references":[46,2],"type":"trigger","data":{"on":46,"references_in_body":[46,2],"name":"organizations_create","sql":"CREATE TRIGGER IF NOT EXISTS organizations_create\nBEFORE INSERT ON organizations\nBEGIN\n    INSERT INTO cedar_entities(entity_type, entity_id)\n    VALUES ('Celest::Organization', NEW.id);\nEND;"}},{"id":68,"references":[46,4],"type":"trigger","data":{"on":46,"references_in_body":[46,4],"name":"organizations_create_parent","sql":"CREATE TRIGGER IF NOT EXISTS organizations_create_parent\nAFTER INSERT ON organizations\nWHEN NEW.parent_id IS NOT NULL\nBEGIN\n    INSERT INTO cedar_relationships(entity_type, entity_id, parent_type, parent_id)\n    VALUES ('Celest::Organization', NEW.id, NEW.parent_type, NEW.parent_id);\nEND;"}},{"id":69,"references":[46,4],"type":"trigger","data":{"on":46,"references_in_body":[46,4],"name":"organizations_add_parent","sql":"CREATE TRIGGER IF NOT EXISTS organizations_add_parent\nAFTER UPDATE OF parent_id ON organizations\nWHEN OLD.parent_id IS NULL AND NEW.parent_id IS NOT NULL\nBEGIN\n    INSERT INTO cedar_relationships(entity_type, entity_id, parent_type, parent_id)\n    VALUES ('Celest::Organization', NEW.id, NEW.parent_type, NEW.parent_id);\nEND;"}},{"id":70,"references":[46,4],"type":"trigger","data":{"on":46,"references_in_body":[46,4],"name":"organizations_set_parent","sql":"CREATE TRIGGER IF NOT EXISTS organizations_set_parent\nAFTER UPDATE OF parent_type, parent_id ON organizations\nWHEN (OLD.parent_type != NEW.parent_type OR OLD.parent_id != NEW.parent_id) AND NEW.parent_id IS NOT NULL\nBEGIN\n    UPDATE cedar_relationships\n    SET \n        parent_type = NEW.parent_type,\n        parent_id = NEW.parent_id\n    WHERE \n        entity_id = OLD.id \n        AND entity_type = 'Celest::Organization';\nEND;"}},{"id":71,"references":[46,4],"type":"trigger","data":{"on":46,"references_in_body":[46,4],"name":"organizations_remove_parent","sql":"CREATE TRIGGER IF NOT EXISTS organizations_remove_parent\nAFTER UPDATE OF parent_id ON organizations\nWHEN OLD.parent_id IS NOT NULL AND NEW.parent_id IS NULL\nBEGIN\n    DELETE FROM cedar_relationships\n    WHERE \n        entity_id = OLD.id \n        AND entity_type = 'Celest::Organization'\n        AND parent_id = OLD.parent_id\n        AND parent_type = OLD.parent_type;\nEND;"}},{"id":72,"references":[46,4,2],"type":"trigger","data":{"on":46,"references_in_body":[46,4,2],"name":"organizations_delete","sql":"CREATE TRIGGER IF NOT EXISTS organizations_delete\nAFTER DELETE ON organizations\nBEGIN\n    DELETE FROM cedar_relationships\n    WHERE \n        entity_type = 'Celest::Organization'\n        AND entity_id = OLD.id;\n    DELETE FROM cedar_relationships\n    WHERE \n        parent_type = 'Celest::Organization'\n        AND parent_id = OLD.id;\n    DELETE FROM cedar_entities\n    WHERE\n        entity_type = 'Celest::Organization'\n        AND entity_id = OLD.id;\nEND;"}},{"id":73,"references":[],"type":"table","data":{"name":"operations","was_declared_in_moor":true,"columns":[{"name":"id","getter_name":"id","moor_type":"string","nullable":false,"customConstraints":"NOT NULL PRIMARY KEY","default_dart":null,"default_client_dart":null,"dsl_features":["primary-key"]},{"name":"metadata","getter_name":"metadata","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"response","getter_name":"response","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"error","getter_name":"error","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"done","getter_name":"done","moor_type":"bool","nullable":false,"customConstraints":"NOT NULL GENERATED ALWAYS AS (response IS NOT NULL OR error IS NOT NULL) VIRTUAL","default_dart":null,"default_client_dart":null,"dsl_features":["unknown"]},{"name":"create_time","getter_name":"createTime","moor_type":"dateTime","nullable":false,"customConstraints":"NOT NULL DEFAULT (unixepoch('now', 'subsec'))","default_dart":"const CustomExpression('unixepoch(\\'now\\', \\'subsec\\')')","default_client_dart":null,"dsl_features":[]},{"name":"full_resource_name","getter_name":"fullResourceName","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"owner_type","getter_name":"ownerType","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"owner_id","getter_name":"ownerId","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"resource_type","getter_name":"resourceType","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]},{"name":"resource_id","getter_name":"resourceId","moor_type":"string","nullable":true,"customConstraints":"","default_dart":null,"default_client_dart":null,"dsl_features":[]}],"is_virtual":false,"without_rowid":false,"constraints":[]}},{"id":74,"references":[73],"type":"index","data":{"on":73,"name":"operations_fk_owner_idx","sql":"CREATE INDEX IF NOT EXISTS operations_fk_owner_idx ON operations(owner_type, owner_id);","unique":false,"columns":[]}},{"id":75,"references":[73],"type":"index","data":{"on":73,"name":"operations_fk_resource_idx","sql":"CREATE INDEX IF NOT EXISTS operations_fk_resource_idx ON operations(resource_type, resource_id);","unique":false,"columns":[]}},{"id":76,"references":[73,2],"type":"trigger","data":{"on":73,"references_in_body":[73,2],"name":"operations_trigger_create","sql":"CREATE TRIGGER IF NOT EXISTS operations_trigger_create\nBEFORE INSERT ON operations\nBEGIN\n    INSERT INTO cedar_entities(entity_type, entity_id)\n    VALUES ('Celest::Operation', NEW.id);\nEND;"}},{"id":77,"references":[73,4],"type":"trigger","data":{"on":73,"references_in_body":[73,4],"name":"operations_trigger_create_owner","sql":"CREATE TRIGGER IF NOT EXISTS operations_trigger_create_owner\nAFTER INSERT ON operations\nWHEN NEW.owner_id IS NOT NULL\nBEGIN\n    INSERT INTO cedar_relationships(entity_type, entity_id, parent_type, parent_id)\n    VALUES ('Celest::Operation', NEW.id, NEW.owner_type, NEW.owner_id);\nEND;"}},{"id":78,"references":[73,4],"type":"trigger","data":{"on":73,"references_in_body":[73,4],"name":"operations_trigger_create_resource","sql":"CREATE TRIGGER IF NOT EXISTS operations_trigger_create_resource\nAFTER INSERT ON operations\nWHEN NEW.resource_id IS NOT NULL\nBEGIN\n    INSERT INTO cedar_relationships(entity_type, entity_id, parent_type, parent_id)\n    VALUES ('Celest::Operation', NEW.id, NEW.resource_type, NEW.resource_id);\nEND;"}},{"id":79,"references":[73,4],"type":"trigger","data":{"on":73,"references_in_body":[73,4],"name":"operations_trigger_add_owner","sql":"CREATE TRIGGER IF NOT EXISTS operations_trigger_add_owner\nAFTER UPDATE OF owner_id ON operations\nWHEN OLD.owner_id IS NULL AND NEW.owner_id IS NOT NULL\nBEGIN\n    INSERT INTO cedar_relationships(entity_type, entity_id, parent_type, parent_id)\n    VALUES ('Celest::Operation', NEW.id, NEW.owner_type, NEW.owner_id);\nEND;"}},{"id":80,"references":[73,4],"type":"trigger","data":{"on":73,"references_in_body":[73,4],"name":"operations_trigger_add_resource","sql":"CREATE TRIGGER IF NOT EXISTS operations_trigger_add_resource\nAFTER UPDATE OF resource_id ON operations\nWHEN OLD.resource_id IS NULL AND NEW.resource_id IS NOT NULL\nBEGIN\n    INSERT INTO cedar_relationships(entity_type, entity_id, parent_type, parent_id)\n    VALUES ('Celest::Operation', NEW.id, NEW.resource_type, NEW.resource_id);\nEND;"}},{"id":81,"references":[73,4],"type":"trigger","data":{"on":73,"references_in_body":[73,4],"name":"operations_trigger_set_owner","sql":"CREATE TRIGGER IF NOT EXISTS operations_trigger_set_owner\nAFTER UPDATE OF owner_type, owner_id ON operations\nWHEN (OLD.owner_type != NEW.owner_type OR OLD.owner_id != NEW.owner_id) AND OLD.owner_id IS NOT NULL AND NEW.owner_id IS NOT NULL\nBEGIN\n    UPDATE cedar_relationships\n    SET \n        parent_type = NEW.owner_type,\n        parent_id = NEW.owner_id\n    WHERE \n        entity_id = OLD.id\n        AND entity_type = 'Celest::Operation'\n        AND parent_type = OLD.owner_type\n        AND parent_id = OLD.owner_id;\nEND;"}},{"id":82,"references":[73,4],"type":"trigger","data":{"on":73,"references_in_body":[73,4],"name":"operations_trigger_set_resource","sql":"CREATE TRIGGER IF NOT EXISTS operations_trigger_set_resource\nAFTER UPDATE OF resource_type, resource_id ON operations\nWHEN (OLD.resource_type != NEW.resource_type OR OLD.resource_id != NEW.resource_id) AND OLD.resource_id IS NOT NULL AND NEW.resource_id IS NOT NULL\nBEGIN\n    UPDATE cedar_relationships\n    SET \n        parent_type = NEW.resource_type,\n        parent_id = NEW.resource_id\n    WHERE \n        entity_id = OLD.id\n        AND entity_type = 'Celest::Operation'\n        AND parent_type = OLD.resource_type\n        AND parent_id = OLD.resource_id;\nEND;"}},{"id":83,"references":[73,4,2],"type":"trigger","data":{"on":73,"references_in_body":[73,4,2],"name":"operations_trigger_delete","sql":"CREATE TRIGGER IF NOT EXISTS operations_trigger_delete\nAFTER DELETE ON operations\nBEGIN\n    DELETE FROM cedar_relationships\n    WHERE \n        entity_id = OLD.id\n        AND entity_type = 'Celest::Operation';\n    DELETE FROM cedar_entities\n    WHERE\n        entity_id = OLD.id\n        AND entity_type = 'Celest::Operation';\nEND;"}}]}